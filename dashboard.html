<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Dashboard ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</title>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body { font-family: "Prompt", sans-serif; background: #f9f6ff; padding: 20px; }
    h1 { text-align: center; color: #6a1b9a; }
    .chart { margin: 20px auto; max-width: 800px; }
    h3 { margin-top: 30px; color: #333; }
  </style>
</head>
<body>
  <h1>üìä Dashboard ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏£‡∏π</h1>
  <div id="subject_chart" class="chart"></div>
  <div id="homeroom_chart" class="chart"></div>
  <div id="comments"></div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbx7zoW9S4ulivPPwSLOWLKLHuyE16IkWkGAsrFrBktgof0ta5Q9jDW1Fb3YOJjo4y4i/exec";

fetch(WEB_APP_URL)
.then(res => res.json())
.then(data => {
  // ‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ä‡∏≤
  let subjectData = [['‡∏Ñ‡∏£‡∏π+‡∏ß‡∏¥‡∏ä‡∏≤', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢']];
  data.subjects.forEach(r => subjectData.push([r.teacher_subject, parseFloat(r.avg)]));

  // ‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô
  let homeroomData = [['‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢']];
  data.homerooms.forEach(r => homeroomData.push([r.homeroom, parseFloat(r.avg)]));

  // ‡πÇ‡∏´‡∏•‡∏î Google Chart
  google.charts.load('current', {packages:['corechart']});
  google.charts.setOnLoadCallback(() => {
    var dt1 = google.visualization.arrayToDataTable(subjectData);
    new google.visualization.ColumnChart(document.getElementById('subject_chart'))
      .draw(dt1, {title: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ä‡∏≤'});
    
    var dt2 = google.visualization.arrayToDataTable(homeroomData);
    new google.visualization.ColumnChart(document.getElementById('homeroom_chart'))
      .draw(dt2, {title: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô'});
  });

  // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå
  let commentsHTML = "<h2>üí¨ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</h2>";
  data.subjects.forEach(r => {
    if (r.comments.length) {
      commentsHTML += `<h3>${r.teacher_subject}</h3><ul>`;
      r.comments.forEach(c => commentsHTML += `<li>${c}</li>`);
      commentsHTML += "</ul>";
    }
  });
  document.getElementById("comments").innerHTML = commentsHTML;
});
</script>
</body>
</html>

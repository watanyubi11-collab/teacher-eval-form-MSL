<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{ --pink:#d81b60; --card:#fff; --bg:#fafafa; --border:#eee; }
    *{box-sizing:border-box}
    body{font-family:"Prompt",system-ui; background:var(--bg); margin:0; padding:20px}
    h1{text-align:center; color:var(--pink); margin:0 0 18px}
    .box{max-width:1100px; margin:0 auto 20px; background:var(--card); padding:18px; border-radius:18px; box-shadow:0 6px 16px rgba(0,0,0,.06)}
    h2{margin:6px 0 10px; color:#ad1457}
    table{width:100%; border-collapse:collapse}
    th,td{border:1px solid var(--border); padding:8px 10px; text-align:center}
    th{background:#fce4ec}
    canvas{margin-top:14px}
  </style>
</head>
<body>
  <h1>üìä Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h1>

  <div class="box">
    <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ (‡∏ï‡∏≤‡∏°‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô)</h2>
    <table id="tblSubject"><tr><th>‡∏Ñ‡∏£‡∏π (‡∏ß‡∏¥‡∏ä‡∏≤)</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th></tr></table>
    <canvas id="chartSubject" height="120"></canvas>
  </div>

  <div class="box">
    <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô</h2>
    <table id="tblHomeroom"><tr><th>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th></tr></table>
    <canvas id="chartHomeroom" height="120"></canvas>
  </div>

  <div class="box">
    <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô</h2>
    <table id="tblGrade"><tr><th>‡∏ä‡∏±‡πâ‡∏ô</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th></tr></table>
    <canvas id="chartGrade" height="120"></canvas>
  </div>

  <script>
    // üëâ ‡πÉ‡∏ä‡πâ URL Web App ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö index.html ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° ?mode=summary
    const SUMMARY_URL = "https://script.google.com/macros/s/AKfycbyzXJVR5xaNmJLBURxrMin4A9CmTBtcEIpHY1qK6uayTVEc8Ki3rIRqox5ucVlUNjzy/exec?mode=summary";

    async function loadSummary(){
      const res = await fetch(SUMMARY_URL);
      const data = await res.json();

      // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      const tSub = document.getElementById("tblSubject");
      data.subjects.forEach(s=>{
        tSub.insertAdjacentHTML("beforeend", `<tr><td>${s.teacher_subject}</td><td>${s.avg}</td></tr>`);
      });
      const tHome = document.getElementById("tblHomeroom");
      data.homerooms.forEach(h=>{
        tHome.insertAdjacentHTML("beforeend", `<tr><td>${h.homeroom}</td><td>${h.avg}</td></tr>`);
      });
      const tGrade = document.getElementById("tblGrade");
      data.grades.forEach(g=>{
        tGrade.insertAdjacentHTML("beforeend", `<tr><td>${g.grade}</td><td>${g.avg}</td></tr>`);
      });

      // ‡∏Å‡∏£‡∏≤‡∏ü
      new Chart(document.getElementById("chartSubject"),{
        type:"bar",
        data:{
          labels:data.subjects.map(s=>s.teacher_subject),
          datasets:[{label:"‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤", data:data.subjects.map(s=>s.avg)}]
        }
      });

      new Chart(document.getElementById("chartHomeroom"),{
        type:"bar",
        data:{
          labels:data.homerooms.map(h=>h.homeroom),
          datasets:[{label:"‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô", data:data.homerooms.map(h=>h.avg)}]
        }
      });

      new Chart(document.getElementById("chartGrade"),{
        type:"line",
        data:{
          labels:data.grades.map(g=>g.grade),
          datasets:[{label:"‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô", data:data.grades.map(g=>g.avg), fill:false}]
        }
      });
    }
    loadSummary();
  </script>
</body>
</html>

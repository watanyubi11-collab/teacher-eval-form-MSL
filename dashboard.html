<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>üìä Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏£‡∏π</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: "Prompt", sans-serif;
      background: #fdfdfd;
      padding: 20px;
      color: #333;
    }
    h2 {
      margin-top: 30px;
      color: #444;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #eee;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #ffdfef;
    }
    #subject_chart, #homeroom_chart {
      margin-top: 30px;
    }
    #comments {
      margin-top: 30px;
      background: #fff8f8;
      padding: 15px;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <h1>üìä Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏£‡∏π</h1>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ä‡∏≤ -->
  <h2>üìò ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ä‡∏≤</h2>
  <table id="subject_table">
    <thead>
      <tr><th>‡∏Ñ‡∏£‡∏π+‡∏ß‡∏¥‡∏ä‡∏≤</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="subject_chart" style="height:400px;"></div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô -->
  <h2>üè´ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô</h2>
  <table id="homeroom_table">
    <thead>
      <tr><th>‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="homeroom_chart" style="height:400px;"></div>

  <!-- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô -->
  <h2>üí¨ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</h2>
  <div id="comments"></div>

  <script>
  // ‚úÖ ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Web App ‡∏ó‡∏µ‡πà deploy ‡∏à‡∏≤‡∏Å Apps Script
  const API_URL = "https://script.google.com/macros/s/AKfycbx7zoW9S4ulivPPwSLOWLKLHuyE16IkWkGAsrFrBktgof0ta5Q9jDW1Fb3YOJjo4y4i/exec";

  fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    // ================== ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ä‡∏≤ ==================
    let subjectTableBody = document.querySelector("#subject_table tbody");
    data.subjects.forEach(r => {
      subjectTableBody.innerHTML += `<tr><td>${r.teacher_subject}</td><td>${r.avg}</td></tr>`;
    });

    // ================== ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô ==================
    let homeroomTableBody = document.querySelector("#homeroom_table tbody");
    data.homerooms.forEach(r => {
      homeroomTableBody.innerHTML += `<tr><td>${r.homeroom}</td><td>${r.avg}</td></tr>`;
    });

    // ================== ‡∏Å‡∏£‡∏≤‡∏ü‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ä‡∏≤ ==================
    let subjectData = [['‡∏Ñ‡∏£‡∏π+‡∏ß‡∏¥‡∏ä‡∏≤', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢']];
    data.subjects.forEach(r => subjectData.push([r.teacher_subject, parseFloat(r.avg)]));
    google.charts.load('current', {packages:['corechart']});
    google.charts.setOnLoadCallback(() => {
      var dt1 = google.visualization.arrayToDataTable(subjectData);
      new google.visualization.ColumnChart(document.getElementById('subject_chart'))
        .draw(dt1, {title: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏£‡∏π‡∏ß‡∏¥‡∏ä‡∏≤', legend:{position:'none'}});
    });

    // ================== ‡∏Å‡∏£‡∏≤‡∏ü‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô ==================
    let homeroomData = [['‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô', '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢']];
    data.homerooms.forEach(r => homeroomData.push([r.homeroom, parseFloat(r.avg)]));
    google.charts.setOnLoadCallback(() => {
      var dt2 = google.visualization.arrayToDataTable(homeroomData);
      new google.visualization.ColumnChart(document.getElementById('homeroom_chart'))
        .draw(dt2, {title: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô', legend:{position:'none'}});
    });

    // ================== ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ ==================
    let commentsHTML = "";
    data.subjects.forEach(r => {
      if (r.comments.length) {
        commentsHTML += `<h3>${r.teacher_subject}</h3><ul>`;
        r.comments.forEach(c => commentsHTML += `<li>${c}</li>`);
        commentsHTML += "</ul>";
      }
    });
    document.getElementById("comments").innerHTML = commentsHTML || "‚Äî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ ‚Äî";
  });
  </script>
</body>
</html>
